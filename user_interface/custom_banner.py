from header import *


custom_banner =	(
	"custom_banner", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(troop_get_slot, ":flag_type", "trp_player", slot_troop_custom_banner_flag_type),
				(val_max, ":flag_type", 0),
				(val_add, ":flag_type", custom_banner_flag_types_begin),
				(troop_get_slot, ":map_flag_type", "trp_player", slot_troop_custom_banner_map_flag_type),
				(val_max, ":map_flag_type", 0),
				(val_add, ":map_flag_type", custom_banner_flag_map_types_begin),
##        (create_mesh_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_1", ":flag_type", "tableau_custom_banner_square", "trp_player"),
				(troop_get_slot, ":bg_color_1", "trp_player", slot_troop_custom_banner_bg_color_1),
				(troop_get_slot, ":bg_color_2", "trp_player", slot_troop_custom_banner_bg_color_2),

				(create_text_overlay, reg1, "str_color_no_1", 0),
				(position_set_x, pos1, 40),
				(position_set_y, pos1, 550),
				(overlay_set_position, reg1, pos1),
				(create_text_overlay, reg1, "str_color_no_2", 0),
				(position_set_x, pos1, 40),
				(position_set_y, pos1, 500),
				(overlay_set_position, reg1, pos1),

				(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_22", "mesh_color_picker", "tableau_color_picker", ":bg_color_1"),
				(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_23", "mesh_color_picker", "tableau_color_picker", ":bg_color_2"),
				(position_set_x, pos1, 200),
				(position_set_y, pos1, 565),
				(overlay_set_position, "$g_presentation_obj_custom_banner_22", pos1),
				(position_set_y, pos1, 515),
				(overlay_set_position, "$g_presentation_obj_custom_banner_23", pos1),
				(position_set_x, pos1, 250),
				(position_set_y, pos1, 250),
				(overlay_set_size, "$g_presentation_obj_custom_banner_22", pos1),
				(overlay_set_size, "$g_presentation_obj_custom_banner_23", pos1),

				(create_button_overlay, "$g_presentation_obj_custom_banner_2", "str_change", tf_center_justify),
				(create_button_overlay, "$g_presentation_obj_custom_banner_3", "str_change", tf_center_justify),
				(create_button_overlay, "$g_presentation_obj_custom_banner_4", "str_change_background", tf_center_justify),
				(create_button_overlay, "$g_presentation_obj_custom_banner_5", "str_change", tf_center_justify),
				(create_button_overlay, "$g_presentation_obj_custom_banner_19", "str_change", tf_center_justify),
				(create_button_overlay, "$g_presentation_obj_custom_banner_20", "str_accept", tf_center_justify),
				(troop_get_slot, ":num_charges", "trp_player", slot_troop_custom_banner_num_charges),
				(create_button_overlay, "$g_presentation_obj_custom_banner_16", "str_randomize", tf_center_justify),
				(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_17", ":flag_type", "tableau_custom_banner_default", "trp_player"),
				(try_begin),
					(eq, ":map_flag_type", "mesh_custom_map_banner_01"),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":map_flag_type", "tableau_custom_banner_square", "trp_player"),
				(else_try),
					(eq, ":map_flag_type", "mesh_custom_map_banner_02"),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":map_flag_type", "tableau_custom_banner_short", "trp_player"),
				(else_try),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":map_flag_type", "tableau_custom_banner_tall", "trp_player"),
				(try_end),
				(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_1", -1, "tableau_custom_banner_square_no_mesh", "trp_player"),
				(create_text_overlay, reg1, "str_sample_banner", tf_center_justify),
				(position_set_x, pos1, 825),
				(position_set_y, pos1, 650),
				(overlay_set_position, reg1, pos1),
				(create_text_overlay, reg1, "str_sample_map_banner", tf_center_justify),
				(position_set_y, pos1, 500),
				(overlay_set_position, reg1, pos1),

				(position_set_x, pos1, 800),
				(position_set_y, pos1, 640),
				(overlay_set_position, "$g_presentation_obj_custom_banner_17", pos1),
				(position_set_x, pos1, 780),
				(position_set_y, pos1, 315),
				(overlay_set_position, "$g_presentation_obj_custom_banner_18", pos1),
				(position_set_x, pos1, 50),
				(position_set_y, pos1, 50),
				(overlay_set_size, "$g_presentation_obj_custom_banner_17", pos1),
				(position_set_x, pos1, 50),
				(position_set_y, pos1, 50),
				(overlay_set_size, "$g_presentation_obj_custom_banner_18", pos1),


				(create_text_overlay, reg1, "str_number_of_charges", 0),
				(position_set_x, pos1, 40),
				(position_set_y, pos1, 350),
				(overlay_set_position, reg1, pos1),

				(assign, reg1, ":num_charges"),
				(create_text_overlay, reg2, "str_reg1", tf_center_justify),
				(position_set_x, pos1, 350),
				(position_set_y, pos1, 350),
				(overlay_set_position, reg2, pos1),
				(try_begin),
					(lt, ":num_charges", 4),
					(create_button_overlay, "$g_presentation_obj_custom_banner_15", "str_plus", tf_center_justify),
					(position_set_x, pos1, 385),
					(position_set_y, pos1, 350),
					(overlay_set_position, "$g_presentation_obj_custom_banner_15", pos1),
				(else_try),
					(assign, "$g_presentation_obj_custom_banner_15", -1),
				(try_end),
				(try_begin),
					(gt, ":num_charges", 0),
					(create_button_overlay, "$g_presentation_obj_custom_banner_21", "str_minus", tf_center_justify),
					(position_set_x, pos1, 370),
					(position_set_y, pos1, 350),
					(overlay_set_position, "$g_presentation_obj_custom_banner_21", pos1),
				(else_try),
					(assign, "$g_presentation_obj_custom_banner_21", -1),
				(try_end),

				(try_begin),
					(ge, ":num_charges", 1),
					(create_text_overlay, reg1, "str_charge", tf_center_justify),
					(position_set_x, pos1, 300),
					(position_set_y, pos1, 300),
					(overlay_set_position, reg1, pos1),
					(create_text_overlay, reg1, "str_color", tf_center_justify),
					(position_set_x, pos1, 550),
					(position_set_y, pos1, 300),
					(overlay_set_position, reg1, pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_14", "str_change_charge_position", tf_center_justify),
					(position_set_y, pos1, 350),
					(position_set_x, pos1, 550),
					(overlay_set_position, "$g_presentation_obj_custom_banner_14", pos1),

					(create_text_overlay, reg1, "str_charge_no_1", 0),
					(position_set_x, pos1, 40),
					(position_set_y, pos1, 240),
					(overlay_set_position, reg1, pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_6", "str_change", 0),
					(position_set_x, pos1, 310),
					(overlay_set_position, "$g_presentation_obj_custom_banner_6", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_7", "str_change", 0),
					(position_set_x, pos1, 560),
					(overlay_set_position, "$g_presentation_obj_custom_banner_7", pos1),
					(troop_get_slot, ":cur_charge", "trp_player", slot_troop_custom_banner_charge_type_1),
					(val_mod, ":cur_charge", 256),
					(val_add, ":cur_charge", custom_banner_charges_begin),
					(create_image_button_overlay, "$g_presentation_obj_custom_banner_24", ":cur_charge", ":cur_charge"),
					(position_set_x, pos1, 260),
					(position_set_y, pos1, 255),
					(overlay_set_position, "$g_presentation_obj_custom_banner_24", pos1),
					(position_set_x, pos1, 50),
					(position_set_y, pos1, 50),
					(overlay_set_size, "$g_presentation_obj_custom_banner_24", pos1),
					(troop_get_slot, ":cur_charge_color", "trp_player", slot_troop_custom_banner_charge_color_1),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_28", "mesh_color_picker", "tableau_color_picker", ":cur_charge_color"),
					(position_set_x, pos1, 530),
					(position_set_y, pos1, 255),
					(overlay_set_position, "$g_presentation_obj_custom_banner_28", pos1),
					(position_set_x, pos1, 250),
					(position_set_y, pos1, 250),
					(overlay_set_size, "$g_presentation_obj_custom_banner_28", pos1),

					(create_button_overlay, "$g_presentation_obj_custom_banner_32", "str_flip_horizontal", 0),
					(position_set_x, pos1, 700),
					(position_set_y, pos1, 240),
					(overlay_set_position, "$g_presentation_obj_custom_banner_32", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_33", "str_flip_vertical", 0),
					(position_set_x, pos1, 800),
					(overlay_set_position, "$g_presentation_obj_custom_banner_33", pos1),
				(try_end),
				(try_begin),
					(ge, ":num_charges", 2),
					(create_text_overlay, reg1, "str_charge_no_2", 0),
					(position_set_x, pos1, 40),
					(position_set_y, pos1, 180),
					(overlay_set_position, reg1, pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_8", "str_change", 0),
					(position_set_x, pos1, 310),
					(overlay_set_position, "$g_presentation_obj_custom_banner_8", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_9", "str_change", 0),
					(position_set_x, pos1, 560),
					(overlay_set_position, "$g_presentation_obj_custom_banner_9", pos1),
					(troop_get_slot, ":cur_charge", "trp_player", slot_troop_custom_banner_charge_type_2),
					(val_mod, ":cur_charge", 256),
					(val_add, ":cur_charge", custom_banner_charges_begin),
					(create_image_button_overlay, "$g_presentation_obj_custom_banner_25", ":cur_charge", ":cur_charge"),
					(position_set_x, pos1, 260),
					(position_set_y, pos1, 195),
					(overlay_set_position, "$g_presentation_obj_custom_banner_25", pos1),
					(position_set_x, pos1, 50),
					(position_set_y, pos1, 50),
					(overlay_set_size, "$g_presentation_obj_custom_banner_25", pos1),
					(troop_get_slot, ":cur_charge_color", "trp_player", slot_troop_custom_banner_charge_color_2),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_29", "mesh_color_picker", "tableau_color_picker", ":cur_charge_color"),
					(position_set_x, pos1, 530),
					(position_set_y, pos1, 195),
					(overlay_set_position, "$g_presentation_obj_custom_banner_29", pos1),
					(position_set_x, pos1, 250),
					(position_set_y, pos1, 250),
					(overlay_set_size, "$g_presentation_obj_custom_banner_29", pos1),

					(create_button_overlay, "$g_presentation_obj_custom_banner_34", "str_flip_horizontal", 0),
					(position_set_x, pos1, 700),
					(position_set_y, pos1, 180),
					(overlay_set_position, "$g_presentation_obj_custom_banner_34", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_35", "str_flip_vertical", 0),
					(position_set_x, pos1, 800),
					(overlay_set_position, "$g_presentation_obj_custom_banner_35", pos1),
				(try_end),
				(try_begin),
					(ge, ":num_charges", 3),
					(create_text_overlay, reg1, "str_charge_no_3", 0),
					(position_set_x, pos1, 40),
					(position_set_y, pos1, 120),
					(overlay_set_position, reg1, pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_10", "str_change", 0),
					(position_set_x, pos1, 310),
					(overlay_set_position, "$g_presentation_obj_custom_banner_10", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_11", "str_change", 0),
					(position_set_x, pos1, 560),
					(overlay_set_position, "$g_presentation_obj_custom_banner_11", pos1),
					(troop_get_slot, ":cur_charge", "trp_player", slot_troop_custom_banner_charge_type_3),
					(val_mod, ":cur_charge", 256),
					(val_add, ":cur_charge", custom_banner_charges_begin),
					(create_image_button_overlay, "$g_presentation_obj_custom_banner_26", ":cur_charge", ":cur_charge"),
					(position_set_x, pos1, 260),
					(position_set_y, pos1, 135),
					(overlay_set_position, "$g_presentation_obj_custom_banner_26", pos1),
					(position_set_x, pos1, 50),
					(position_set_y, pos1, 50),
					(overlay_set_size, "$g_presentation_obj_custom_banner_26", pos1),
					(troop_get_slot, ":cur_charge_color", "trp_player", slot_troop_custom_banner_charge_color_3),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_30", "mesh_color_picker", "tableau_color_picker", ":cur_charge_color"),
					(position_set_x, pos1, 530),
					(position_set_y, pos1, 135),
					(overlay_set_position, "$g_presentation_obj_custom_banner_30", pos1),
					(position_set_x, pos1, 250),
					(position_set_y, pos1, 250),
					(overlay_set_size, "$g_presentation_obj_custom_banner_30", pos1),

					(create_button_overlay, "$g_presentation_obj_custom_banner_36", "str_flip_horizontal", 0),
					(position_set_x, pos1, 700),
					(position_set_y, pos1, 120),
					(overlay_set_position, "$g_presentation_obj_custom_banner_36", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_37", "str_flip_vertical", 0),
					(position_set_x, pos1, 800),
					(overlay_set_position, "$g_presentation_obj_custom_banner_37", pos1),
				(try_end),
				(try_begin),
					(ge, ":num_charges", 4),
					(create_text_overlay, reg1, "str_charge_no_4", 0),
					(position_set_x, pos1, 40),
					(position_set_y, pos1, 60),
					(overlay_set_position, reg1, pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_12", "str_change", 0),
					(position_set_x, pos1, 310),
					(overlay_set_position, "$g_presentation_obj_custom_banner_12", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_13", "str_change", 0),
					(position_set_x, pos1, 560),
					(overlay_set_position, "$g_presentation_obj_custom_banner_13", pos1),
					(troop_get_slot, ":cur_charge", "trp_player", slot_troop_custom_banner_charge_type_4),
					(val_mod, ":cur_charge", 256),
					(val_add, ":cur_charge", custom_banner_charges_begin),
					(create_image_button_overlay, "$g_presentation_obj_custom_banner_27", ":cur_charge", ":cur_charge"),
					(position_set_x, pos1, 260),
					(position_set_y, pos1, 75),
					(overlay_set_position, "$g_presentation_obj_custom_banner_27", pos1),
					(position_set_x, pos1, 50),
					(position_set_y, pos1, 50),
					(overlay_set_size, "$g_presentation_obj_custom_banner_27", pos1),
					(troop_get_slot, ":cur_charge_color", "trp_player", slot_troop_custom_banner_charge_color_4),
					(create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_31", "mesh_color_picker", "tableau_color_picker", ":cur_charge_color"),
					(position_set_x, pos1, 530),
					(position_set_y, pos1, 75),
					(overlay_set_position, "$g_presentation_obj_custom_banner_31", pos1),
					(position_set_x, pos1, 250),
					(position_set_y, pos1, 250),
					(overlay_set_size, "$g_presentation_obj_custom_banner_31", pos1),

					(create_button_overlay, "$g_presentation_obj_custom_banner_38", "str_flip_horizontal", 0),
					(position_set_x, pos1, 700),
					(position_set_y, pos1, 60),
					(overlay_set_position, "$g_presentation_obj_custom_banner_38", pos1),
					(create_button_overlay, "$g_presentation_obj_custom_banner_39", "str_flip_vertical", 0),
					(position_set_x, pos1, 800),
					(overlay_set_position, "$g_presentation_obj_custom_banner_39", pos1),
				(try_end),

				(position_set_x, pos1, 350),
				(position_set_y, pos1, 400),
				(overlay_set_position, "$g_presentation_obj_custom_banner_1", pos1),
				(position_set_x, pos1, 275),
				(position_set_y, pos1, 550),
				(overlay_set_position, "$g_presentation_obj_custom_banner_2", pos1),
				(position_set_y, pos1, 500),
				(overlay_set_position, "$g_presentation_obj_custom_banner_3", pos1),
				(position_set_x, pos1, 175),
				(position_set_y, pos1, 600),
				(overlay_set_position, "$g_presentation_obj_custom_banner_4", pos1),
				(position_set_x, pos1, 880),
				(position_set_y, pos1, 575),
				(overlay_set_position, "$g_presentation_obj_custom_banner_5", pos1),
				(position_set_y, pos1, 400),
				(overlay_set_position, "$g_presentation_obj_custom_banner_19", pos1),
				(position_set_y, pos1, 650),
				(position_set_x, pos1, 175),
				(overlay_set_position, "$g_presentation_obj_custom_banner_16", pos1),
				(position_set_y, pos1, 150),
				(position_set_x, pos1, 850),
				(overlay_set_position, "$g_presentation_obj_custom_banner_20", pos1),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(troop_get_slot, ":num_charges", "trp_player", slot_troop_custom_banner_num_charges),
				(try_begin),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_2"),
					(eq, ":object", "$g_presentation_obj_custom_banner_22"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_bg_color_1),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_3"),
					(eq, ":object", "$g_presentation_obj_custom_banner_23"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_bg_color_2),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_4"),
					(eq, ":object", "$g_presentation_obj_custom_banner_1"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_background_selection"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_5"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_flag_type_selection"),
				(else_try),
					(ge, ":num_charges", 1),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_6"),
					(eq, ":object", "$g_presentation_obj_custom_banner_24"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_type_1),
					(start_presentation, "prsnt_banner_charge_selection"),
				(else_try),
					(ge, ":num_charges", 1),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_7"),
					(eq, ":object", "$g_presentation_obj_custom_banner_28"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_color_1),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(ge, ":num_charges", 2),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_8"),
					(eq, ":object", "$g_presentation_obj_custom_banner_25"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_type_2),
					(start_presentation, "prsnt_banner_charge_selection"),
				(else_try),
					(ge, ":num_charges", 2),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_9"),
					(eq, ":object", "$g_presentation_obj_custom_banner_29"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_color_2),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(ge, ":num_charges", 3),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_10"),
					(eq, ":object", "$g_presentation_obj_custom_banner_26"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_type_3),
					(start_presentation, "prsnt_banner_charge_selection"),
				(else_try),
					(ge, ":num_charges", 3),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_11"),
					(eq, ":object", "$g_presentation_obj_custom_banner_30"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_color_3),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(ge, ":num_charges", 4),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_12"),
					(eq, ":object", "$g_presentation_obj_custom_banner_27"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_type_4),
					(start_presentation, "prsnt_banner_charge_selection"),
				(else_try),
					(ge, ":num_charges", 4),
					(this_or_next|eq, ":object", "$g_presentation_obj_custom_banner_13"),
					(eq, ":object", "$g_presentation_obj_custom_banner_31"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(assign, "$g_presentation_output_slot", slot_troop_custom_banner_charge_color_4),
					(start_presentation, "prsnt_color_selection"),
				(else_try),
					(ge, ":num_charges", 1),
					(eq, ":object", "$g_presentation_obj_custom_banner_14"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_charge_positioning"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_15"),
					(troop_get_slot, ":num_charges", "trp_player", slot_troop_custom_banner_num_charges),
					(val_add, ":num_charges", 1),
					(val_clamp, ":num_charges", 0, 5),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_num_charges, ":num_charges"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_21"),
					(troop_get_slot, ":num_charges", "trp_player", slot_troop_custom_banner_num_charges),
					(val_sub, ":num_charges", 1),
					(val_clamp, ":num_charges", 0, 5),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_num_charges, ":num_charges"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_16"),
					(call_script, "script_get_random_custom_banner", "trp_player"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_17"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_flag_type_selection"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_18"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_flag_map_type_selection"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_19"),
					(assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
					(start_presentation, "prsnt_banner_flag_map_type_selection"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_32"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_1),
					(store_mod, ":charge_type_base", ":charge_type", 256),
					(val_div, ":charge_type", 256),
					(store_mod, ":flag", ":charge_type", 2),
					(val_div, ":charge_type", 2), #remove flag
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":charge_type", 2),
					(val_add, ":charge_type", ":flag"),
					(val_mul, ":charge_type", 256),
					(val_add, ":charge_type", ":charge_type_base"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_1, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_34"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_2),
					(store_mod, ":charge_type_base", ":charge_type", 256),
					(val_div, ":charge_type", 256),
					(store_mod, ":flag", ":charge_type", 2),
					(val_div, ":charge_type", 2), #remove flag
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":charge_type", 2),
					(val_add, ":charge_type", ":flag"),
					(val_mul, ":charge_type", 256),
					(val_add, ":charge_type", ":charge_type_base"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_2, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_36"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_3),
					(store_mod, ":charge_type_base", ":charge_type", 256),
					(val_div, ":charge_type", 256),
					(store_mod, ":flag", ":charge_type", 2),
					(val_div, ":charge_type", 2), #remove flag
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":charge_type", 2),
					(val_add, ":charge_type", ":flag"),
					(val_mul, ":charge_type", 256),
					(val_add, ":charge_type", ":charge_type_base"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_3, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_38"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_4),
					(store_mod, ":charge_type_base", ":charge_type", 256),
					(val_div, ":charge_type", 256),
					(store_mod, ":flag", ":charge_type", 2),
					(val_div, ":charge_type", 2), #remove flag
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":charge_type", 2),
					(val_add, ":charge_type", ":flag"),
					(val_mul, ":charge_type", 256),
					(val_add, ":charge_type", ":charge_type_base"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_4, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_33"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_1),
					(store_div, ":flag", ":charge_type", 512),
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":flag", 512),
					(val_mod, ":charge_type", 512), #remove flag
					(val_add, ":charge_type", ":flag"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_1, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_35"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_2),
					(store_div, ":flag", ":charge_type", 512),
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":flag", 512),
					(val_mod, ":charge_type", 512), #remove flag
					(val_add, ":charge_type", ":flag"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_2, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_37"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_3),
					(store_div, ":flag", ":charge_type", 512),
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":flag", 512),
					(val_mod, ":charge_type", 512), #remove flag
					(val_add, ":charge_type", ":flag"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_3, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_39"),
					(troop_get_slot, ":charge_type", "trp_player", slot_troop_custom_banner_charge_type_4),
					(store_div, ":flag", ":charge_type", 512),
					(val_add, ":flag", 1),
					(val_mod, ":flag", 2), #switch flag
					(val_mul, ":flag", 512),
					(val_mod, ":charge_type", 512), #remove flag
					(val_add, ":charge_type", ":flag"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_charge_type_4, ":charge_type"),
					(start_presentation, "prsnt_custom_banner"),
				(else_try),
					(eq, ":object", "$g_presentation_obj_custom_banner_20"),
					(troop_get_slot, ":flag_icon", "trp_player", slot_troop_custom_banner_map_flag_type),
					(try_begin),
						(ge, ":flag_icon", 0),
						(val_add, ":flag_icon", custom_banner_map_icons_begin),
						(party_set_banner_icon, "p_main_party", ":flag_icon"),
					(try_end),
					(presentation_set_duration, 0),
				(try_end),
				]),
##     (ti_on_presentation_run,
##      [(try_begin),
##         (this_or_next|key_clicked, key_space),
##         (this_or_next|key_clicked, key_enter),
##         (this_or_next|key_clicked, key_escape),
##         (key_clicked, key_back_space),
##         (presentation_set_duration, 0),
##       (try_end),
##       ]),
		 ])


banner_charge_positioning =	(
	"banner_charge_positioning", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_position", tf_center_justify),
				(position_set_x, pos1, 500),
				(position_set_y, pos1, 600),
				(overlay_set_position, reg1, pos1),
				(assign, ":pos_x", 125),
				(assign, ":pos_y", 400),
				(call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
				(assign, ":num_positionings", reg0),
				(store_mul, ":x_needed", ":num_positionings", 125),
				(val_sub, ":x_needed", 25),
				(store_div, ":pos_x", ":x_needed", 2),
				(store_sub, ":pos_x", 500, ":pos_x"),
				(try_for_range, ":cur_positioning", 0, ":num_positionings"),
					(create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_positioning_selection", ":cur_positioning"),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 125),
					(overlay_set_position, reg1, pos1),
					(troop_set_slot, "trp_temp_array_a", ":cur_positioning", reg1),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
				(assign, ":num_positionings", reg0),
				(try_for_range, ":trp_slot_index", 0, ":num_positionings"),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_positioning, ":trp_slot_index"),
					(assign, ":num_positionings", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])

banner_charge_selection = (
	"banner_charge_selection", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_charge", tf_center_justify),

				(position_set_x, pos1, 500),
				(position_set_y, pos1, 650),
				(overlay_set_position, reg1, pos1),
				(assign, ":pos_x", 100),
				(assign, ":pos_y", 600),
				(try_for_range, ":cur_charge", custom_banner_charges_begin, custom_banner_charges_end),
					(create_image_button_overlay, reg1, ":cur_charge", ":cur_charge"),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 100),
					(try_begin),
						(gt, ":pos_x", 900),
						(assign, ":pos_x", 100),
						(val_sub, ":pos_y", 100),
					(try_end),
					(overlay_set_position, reg1, pos1),
					(position_set_x, pos1, 80),
					(position_set_y, pos1, 80),
					(overlay_set_size, reg1, pos1),
					(store_sub, ":slot_index", ":cur_charge", custom_banner_charges_begin),
					(troop_set_slot, "trp_temp_array_a", ":slot_index", reg1),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(assign, ":end_cond", custom_banner_charges_end),
				(val_sub, ":end_cond", custom_banner_charges_begin),
				(try_for_range, ":trp_slot_index", 0, ":end_cond"),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(troop_set_slot, "trp_player", "$g_presentation_output_slot", ":trp_slot_index"),
					(assign, ":end_cond", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])


banner_background_selection = 	(
	"banner_background_selection", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_background", tf_center_justify),
				(position_set_x, pos1, 500),
				(position_set_y, pos1, 600),
				(overlay_set_position, reg1, pos1),
				(assign, ":pos_x", 75),
				(assign, ":pos_y", 450),
				(try_for_range, ":cur_banner", custom_banner_backgrounds_begin, custom_banner_backgrounds_end),
					(store_sub, ":slot_index", ":cur_banner", custom_banner_backgrounds_begin),
					(create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_background_selection", ":slot_index"),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 125),
					(try_begin),
						(gt, ":pos_x", 900),
						(assign, ":pos_x", 75),
						(val_sub, ":pos_y", 125),
					(try_end),
					(overlay_set_position, reg1, pos1),
					(troop_set_slot, "trp_temp_array_a", ":slot_index", reg1),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(assign, ":end_cond", custom_banner_backgrounds_end),
				(val_sub, ":end_cond", custom_banner_backgrounds_begin),
				(try_for_range, ":trp_slot_index", 0, ":end_cond"),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_bg_type, ":trp_slot_index"),
					(assign, ":end_cond", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])

banner_flag_type_selection = (
	"banner_flag_type_selection", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_flag_type", tf_center_justify),
				(position_set_x, pos1, 500),
				(position_set_y, pos1, 600),
				(overlay_set_position, reg1, pos1),

				(assign, ":pos_x", 435),
				(assign, ":pos_y", 450),
				(try_for_range, ":cur_flag", custom_banner_flag_types_begin, custom_banner_flag_types_end),
					(store_sub, ":slot_index", ":cur_flag", custom_banner_flag_types_begin),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_flag_type, ":slot_index"),
					(create_image_button_overlay_with_tableau_material, reg1, ":cur_flag", "tableau_custom_banner_default", "trp_player"),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 130),
					(overlay_set_position, reg1, pos1),
					(position_set_x, pos1, 100),
					(position_set_y, pos1, 100),
					(overlay_set_size, reg1, pos1),
					(troop_set_slot, "trp_temp_array_a", ":slot_index", reg1),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(assign, ":end_cond", custom_banner_flag_types_end),
				(val_sub, ":end_cond", custom_banner_flag_types_begin),
				(try_for_range, ":trp_slot_index", 0, ":end_cond"),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_flag_type, ":trp_slot_index"),
					(assign, ":end_cond", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])

banner_flag_map_type_selection = (
	"banner_flag_map_type_selection", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_map_flag_type", tf_center_justify),
				(position_set_x, pos1, 500),
				(position_set_y, pos1, 600),
				(overlay_set_position, reg1, pos1),
				(troop_get_slot, ":bg_type", "trp_player", slot_troop_custom_banner_bg_type),
				(val_add, ":bg_type", custom_banner_backgrounds_begin),
				(assign, ":pos_x", 250),
				(assign, ":pos_y", 150),
				(try_for_range, ":cur_flag", custom_banner_flag_map_types_begin, custom_banner_flag_map_types_end),
					(store_sub, ":slot_index", ":cur_flag", custom_banner_flag_map_types_begin),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_map_flag_type, ":slot_index"),
					(try_begin),
						(eq, ":cur_flag", "mesh_custom_map_banner_01"),
						(create_image_button_overlay_with_tableau_material, reg1, ":cur_flag", "tableau_custom_banner_square", "trp_player"),
					(else_try),
						(eq, ":cur_flag", "mesh_custom_map_banner_02"),
						(create_image_button_overlay_with_tableau_material, reg1, ":cur_flag", "tableau_custom_banner_short", "trp_player"),
					(else_try),
						(create_image_button_overlay_with_tableau_material, reg1, ":cur_flag", "tableau_custom_banner_tall", "trp_player"),
					(try_end),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 200),
					(overlay_set_position, reg1, pos1),
					(position_set_x, pos1, 100),
					(position_set_y, pos1, 100),
					(overlay_set_size, reg1, pos1),
					(troop_set_slot, "trp_temp_array_a", ":slot_index", reg1),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(assign, ":end_cond", custom_banner_flag_map_types_end),
				(val_sub, ":end_cond", custom_banner_flag_map_types_begin),
				(try_for_range, ":trp_slot_index", 0, ":end_cond"),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(troop_set_slot, "trp_player", slot_troop_custom_banner_map_flag_type, ":trp_slot_index"),
					(assign, ":end_cond", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])

color_selection = (
	"color_selection", 0, mesh_load_window,
	 [
		 (ti_on_presentation_load,
			[
				(set_fixed_point_multiplier, 1000),
				(create_text_overlay, reg1, "str_choose_color", tf_center_justify),
				(position_set_x, pos1, 500),
				(position_set_y, pos1, 600),
				(overlay_set_position, reg1, pos1),

				(assign, ":pos_x", 125),
				(assign, ":pos_y", 450),
				(try_for_range, ":i_color", 0, 42),
					(call_script, "script_get_custom_banner_color_from_index", ":i_color"),
					(assign, ":cur_color", reg0),
					(create_image_button_overlay_with_tableau_material, reg1, "mesh_color_picker", "tableau_color_picker", ":cur_color"),
					(position_set_x, pos1, ":pos_x"),
					(position_set_y, pos1, ":pos_y"),
					(val_add, ":pos_x", 50),
					(try_begin),
						(store_mod, ":mod_i_color", ":i_color", 7),
						(eq, ":mod_i_color", 6),
						(assign, ":pos_x", 125),
						(val_sub, ":pos_y", 50),
					(try_end),
					(overlay_set_position, reg1, pos1),
					(position_set_x, pos1, 500),
					(position_set_y, pos1, 500),
					(overlay_set_size, reg1, pos1),
					(store_mul, ":trp_slot_index", ":i_color", 2),
					(store_add, ":trp_slot_color", ":trp_slot_index", 1),
					(troop_set_slot, "trp_temp_array_a", ":trp_slot_index", reg1),
					(troop_set_slot, "trp_temp_array_a", ":trp_slot_color", ":cur_color"),
				(try_end),
				(presentation_set_duration, 999999),
				]),
		 (ti_on_presentation_event_state_change,
			[
				(store_trigger_param_1, ":object"),
				(assign, ":end_cond", 64),
				(try_for_range, ":i_color", 0, ":end_cond"),
					(store_mul, ":trp_slot_index", ":i_color", 2),
					(troop_slot_eq, "trp_temp_array_a", ":trp_slot_index", ":object"),
					(store_add, ":trp_slot_color", ":trp_slot_index", 1),
					(troop_get_slot, ":output_color", "trp_temp_array_a", ":trp_slot_color"),
					(troop_set_slot, "trp_player", "$g_presentation_output_slot", ":output_color"),
					(assign, ":end_cond", 0),
				(try_end),
				(try_begin),
					(gt, "$g_presentation_next_presentation", 0),
					(start_presentation, "$g_presentation_next_presentation"),
				(else_try),
					(presentation_set_duration, 0),
				(try_end),
				]),
		 ])